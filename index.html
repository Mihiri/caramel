<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Caramel by wso2</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Caramel</h1>
        <p class="header">A bootstrap project to create fully dynamic websites using jaggery</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/wso2/caramel/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/wso2/caramel/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/wso2/caramel">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/wso2">wso2</a></p>


      </header>
      <section>
        <h1>Lets Start Tasting Caramel</h1>

<p>Caramel is a MVC framework built for <a href="http://jaggeryjs.org">Jaggery</a>. The intent of the framework is to bootstrap application development and enforce a standard for developing web applications using Jaggery. By no means Caramel trying to lock down developer creativity or freedom but simply trying enforce discipline to large development teams working on Jaggery projects.</p>

<p>A web application written according to Caramel, takes a certain structure, this is to separate the models, controllers and the views</p>

<p>Lets learn by an example; Our use case for the study is a static blog. where you drop posts as files to a defined location and the blog will pick them and show in an appropriately formatted UI</p>

<p>There are few core elements in Caramel</p>

<ul>
<li>
<strong>Application config (app.js)</strong> - Place where you define the context of the application, default theme    and other configuration</li>
<li>
<strong>Main controller</strong> - This is the place which is invoked by a request (the page URL you hit in the browser)</li>
<li>
<strong>Theme</strong> - The place where you put all the templates and reusable template partials</li>
<li>
<strong>Renderer</strong> - The page that contains the rendering function for a particular template</li>
</ul><p>Apart from the above constructs, some of the important concepts behind Caramel is the use of Partials, Pages, Helpers and Modules </p>

<ul>
<li>
<strong>Partials</strong> - A section of html that can be plugged to the main page (i.e: Footer, Navigation, Header)</li>
<li>
<strong>Pages</strong> - The main template which is like a container or a layout this can consist of many partial elements and is rendered during runtime based on the data set.</li>
<li>
<strong>Helpers</strong> - Helper functions that can alter the data rendered on the template (i.e. providing i18n support)</li>
<li>
<strong>Modules</strong> - Modules create information which is needed for views (i.e if you want to call a DB and fetch some data, you do it in a module)</li>
</ul><p>Before we start with the blog example; First let's write a simple Hello World Jaggery App.</p>

<h3>A simple “Hello World” with Caramel</h3>

<p>First the application config <code>/hello/app.js</code></p>

<div class="highlight"><pre><span class="nx">caramel</span><span class="p">.</span><span class="nx">configs</span><span class="p">({</span>
    <span class="nx">context</span><span class="o">:</span> <span class="s1">'/blog'</span><span class="p">,</span>
    <span class="nx">negotiation</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">themer</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">'classic'</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p>The meaning of defining a theme is that, by a configuration change, a new theme can be plugged to the application, and the concept is native to Caramel</p>

<p>Lets call the homepage of the app “index.jag” (<code>/hello/index.jag</code>). In Caramel, the page that servers the request act as one of the controllers of the app. it defines what data needs to be presented in that particular page. Content of the page will be as follows</p>

<div class="highlight"><pre><span class="o">&lt;%</span>
   <span class="kd">var</span> <span class="nx">caramel</span><span class="p">,</span>
   <span class="nx">body</span> <span class="o">=</span> <span class="s2">"Lorem ipsum dolor sit amet"</span><span class="p">;</span>

   <span class="nx">caramel</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'caramel'</span><span class="p">).</span><span class="nx">caramel</span><span class="p">;</span>
   <span class="nx">caramel</span><span class="p">.</span><span class="nx">render</span><span class="p">({</span>
     <span class="s1">'title'</span><span class="o">:</span> <span class="p">{</span><span class="nx">text</span> <span class="o">:</span><span class="s1">'Hello World'</span><span class="p">},</span> <span class="c1">// set html title for index page</span>
     <span class="s1">'body'</span><span class="o">:</span> <span class="p">{</span><span class="nx">text</span><span class="o">:</span><span class="nx">body</span><span class="p">}</span> <span class="c1">//set html body for index page</span>
   <span class="p">});</span>
<span class="o">%&gt;</span>
</pre></div>

<p>This script will provide the title as "Hello World" and the body as "Lorem ipsum" to caramel render function.</p>

<p>Now lets move to the theme, first we need to set handlebars as the default caramel theming engine. Under the <code>themes/classic</code> directory lets create <code>theme.js</code> script</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">engine</span> <span class="o">=</span> <span class="nx">caramel</span><span class="p">.</span><span class="nx">engine</span><span class="p">(</span><span class="s1">'handlebars'</span><span class="p">,</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
<span class="p">}()));</span>
</pre></div>

<p>lets write our handlebars template which is going to define the view for our theme. Create simple.hbs inside <code>themes/classic/pages</code></p>

<div class="highlight"><pre><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>{{include title}}<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div&gt;</span>{{include body}}<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>

<p>This will let our theme to include the title and the body <a href="http://mustache.github.io/mustache.5.html">partials</a>, which we are going to create in the next step. Partials come to play when you have a single template that you need to use in different contexts. For example you can use above template in different contexts by setting different titles and body contents.</p>

<p>Now lets create above inside <code>themes/classic/partials/title.hbs</code> and <code>body.hbs</code> directory, </p>

<p><strong>title.hbs</strong>
<code>
{{{title}}}
</code></p>

<p><strong>body.hbs</strong>
<code>
{{{body}}}
</code></p>

<p>Lets move to the renderer, Create <code>inside themes/classic/renderers/index.js</code> this is the rendering function for index.jag page. It define from which partial the title has to be rendered and whats the data set needed for the partial</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">render</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">theme</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">meta</span><span class="p">,</span> <span class="nx">require</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">theme</span><span class="p">(</span><span class="s1">'simple'</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">title</span><span class="o">:</span> <span class="p">[</span>
         <span class="p">{</span> <span class="nx">partial</span><span class="o">:</span><span class="s1">'title'</span><span class="p">,</span> <span class="nx">context</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span>
     <span class="p">],</span>
     <span class="nx">body</span><span class="o">:</span> <span class="p">[</span>
         <span class="p">{</span> <span class="nx">partial</span><span class="o">:</span><span class="s1">'body'</span><span class="p">,</span> <span class="nx">context</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">body</span><span class="p">}</span>
     <span class="p">]</span>
    <span class="p">});</span>
<span class="p">};</span>
</pre></div>

<p>Hit hello/index.jag in the browser and that should render over caramalized hello world app. The final directory structure of the app will be</p>

<pre><code>/index.jag
/themes
+---/classic
-------/theme.js
+------/renderers
------------/index.js
+------/partials
------------/title.hbs
------------/body.hbs
+------/pages
----------/simple.hbs
</code></pre>

<h2>Lets write a real world application</h2>

<p>As we talked about, lets take a blog engine as an example, and compose one using caramel.</p>

<p>First create a module with a function  which go through files within a given directory and reads file content. Will call this module reader, create reader.js inside top level modules directory with readPosts function. [/modules/reader.js]</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">readPosts</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">"content/posts/"</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">dir</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">File</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">list</span> <span class="o">=</span> <span class="nx">dir</span><span class="p">.</span><span class="nx">listFiles</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">body</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">timeArray</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">list</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
     <span class="kd">var</span> <span class="nx">timestamp</span> <span class="o">=</span> <span class="nx">list</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getName</span><span class="p">();</span> <span class="c1">//read the filename, file created //timestamp</span>
     <span class="nx">timeArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">timestamp</span><span class="p">);</span>
         <span class="c1">// sort filename array in //order to display newest post on the top</span>
     <span class="nx">timeArray</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">){</span><span class="k">return</span> <span class="nx">a</span><span class="o">-</span><span class="nx">b</span><span class="p">});</span> 
    <span class="p">}</span>

    <span class="k">while</span><span class="p">(</span><span class="nx">filename</span><span class="o">=</span><span class="nx">timeArray</span><span class="p">.</span><span class="nx">pop</span><span class="p">())</span> <span class="p">{</span>
         <span class="kd">var</span> <span class="nx">blogFile</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">File</span><span class="p">(</span><span class="nx">path</span><span class="o">+</span><span class="nx">filename</span><span class="p">);</span>
         <span class="nx">blogFile</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">"r"</span><span class="p">);</span>
         <span class="kd">var</span> <span class="nx">post</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
         <span class="nx">post</span> <span class="o">=</span> <span class="nx">blogFile</span><span class="p">.</span><span class="nx">readAll</span><span class="p">();</span>
         <span class="nx">body</span> <span class="o">+=</span><span class="nx">post</span><span class="p">;</span>
         <span class="nx">body</span> <span class="o">+=</span><span class="s2">"&lt;br/&gt;"</span><span class="p">;</span>
         <span class="nx">blogFile</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">body</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>

<p>We need to require this module within our main Controller, so let's update our home page index.jag </p>

<div class="highlight"><pre><span class="o">&lt;%</span>
    <span class="kd">var</span> <span class="nx">caramel</span><span class="p">,</span>
    <span class="nx">reader</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'/modules/reader.js'</span><span class="p">),</span> <span class="c1">//include our reader module</span>
    <span class="nx">caramel</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'caramel'</span><span class="p">).</span><span class="nx">caramel</span><span class="p">;</span>

    <span class="nx">caramel</span><span class="p">.</span><span class="nx">render</span><span class="p">({</span>
     <span class="s1">'title'</span><span class="o">:</span> <span class="p">{</span><span class="nx">text</span> <span class="o">:</span><span class="s1">'Blog'</span><span class="p">},</span>
     <span class="s1">'body'</span><span class="o">:</span> <span class="p">{</span><span class="nx">text</span><span class="o">:</span><span class="nx">reader</span><span class="p">.</span><span class="nx">readPosts</span><span class="p">()}</span>
    <span class="p">});</span>
<span class="o">%&gt;</span>
</pre></div>

<p>As in our Hello World app, we need to define handlebars as the default themeing engine. Under the <code>themes/classic</code> directory lets create theme.js</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">engine</span> <span class="o">=</span> <span class="nx">caramel</span><span class="p">.</span><span class="nx">engine</span><span class="p">(</span><span class="s1">'handlebars'</span><span class="p">,</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
<span class="p">}()));</span>
</pre></div>

<p>lets write some HTML with handlebars which is going to define the view for our theme classic. As we have done earlier, create <code>themes/classic/pages/simple.hbs</code></p>

<div class="highlight"><pre><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;title&gt;</span>{{include title}}<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"{{url "</span><span class="err">/</span><span class="na">themes</span><span class="err">/</span><span class="na">classic</span><span class="err">/</span><span class="na">css</span><span class="err">/</span><span class="na">styles</span><span class="err">.</span><span class="na">css</span><span class="err">"}}"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
{{css .}}
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"{{url "</span><span class="err">/</span><span class="na">themes</span><span class="err">/</span><span class="na">classic</span><span class="err">/</span><span class="na">js</span><span class="err">/</span><span class="na">scripts</span><span class="err">.</span><span class="na">js</span><span class="err">"}}"</span><span class="nt">&gt;&lt;/script&gt;</span>
{{js .}}
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
{{&gt;header}}
<span class="nt">&lt;div&gt;</span>{{include body}}<span class="nt">&lt;/div&gt;</span>
{{&gt;footer}}
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;html&gt;</span>
</pre></div>

<p>The above is the page layout that will let us include the title, header, footer and the body sections (Partials)</p>

<p><code>{{css .}}</code> and <code>{{js .}} are two helpers that includes default css and js in respective directories, these helpers should be placed to</code>themes/classic/helpers`` and will look like</p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">resources</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">page</span><span class="p">,</span> <span class="nx">meta</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
    <span class="nx">js</span><span class="o">:</span> <span class="p">[</span><span class="s1">'navigation.js'</span><span class="p">,</span> <span class="s1">'jquery.validate.js'</span><span class="p">],</span>
    <span class="nx">css</span><span class="o">:</span> <span class="p">[</span><span class="s1">'navigation.css'</span><span class="p">]</span>
    <span class="p">};</span>
<span class="p">};</span>
</pre></div>

<p>Inside Partials we have <code>title.hbs</code> , <code>body.hbs</code> and <code>footer.hbs</code> as same as in <code>Hello World</code> app</p>

<p>Our renderer is also the same at <code>themes/classic/renderers</code></p>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">render</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">theme</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">meta</span><span class="p">,</span> <span class="nx">require</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">theme</span><span class="p">(</span><span class="s1">'simple'</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">title</span><span class="o">:</span> <span class="p">[</span>
         <span class="p">{</span> <span class="nx">partial</span><span class="o">:</span><span class="s1">'title'</span><span class="p">,</span> <span class="nx">context</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span>
     <span class="p">],</span>
     <span class="nx">body</span><span class="o">:</span> <span class="p">[</span>
         <span class="p">{</span> <span class="nx">partial</span><span class="o">:</span><span class="s1">'body'</span><span class="p">,</span> <span class="nx">context</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">body</span><span class="p">}</span>
     <span class="p">]</span>
    <span class="p">});</span>
<span class="p">};</span>
</pre></div>

<p>Now create few HTML formatted files inside <code>content/posts</code> directory with created timestamp as the filename and browse our home page. You can checkout the sample app from <a href="">GitHub</a></p>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>